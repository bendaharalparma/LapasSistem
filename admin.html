<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Lapas</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #eee; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #8B0000; color: #8B0000; padding-bottom: 10px; }
        
        .tab-btn { padding: 10px 20px; background: #ccc; border: none; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: #8B0000; color: white; }
        
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button.save { background: #28a745; color: white; border: none; padding: 15px; width: 100%; margin-top: 20px; font-size: 16px; cursor: pointer; border-radius: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #8B0000; color: white; }
        
        #login-box { max-width: 400px; margin: 100px auto; text-align: center; background: white; padding: 40px; border-radius: 10px; }
    </style>
</head>
<body>

<div id="login-box">
    <h2>Login Admin</h2>
    <input id="email" type="email" placeholder="Email Admin">
    <input id="pass" type="password" placeholder="Password">
    <button class="save" onclick="login()">Masuk</button>
</div>

<div id="panel-box" class="container" style="display:none;">
    <div style="display:flex; justify-content:space-between;">
        <h2>Panel Kontrol</h2>
        <button onclick="logout()" style="background:#333; color:white; border:none; padding:5px 15px;">Logout</button>
    </div>

    <div>
        <button class="tab-btn active" onclick="showTab('settings')" id="btn-set">‚öôÔ∏è Edit Tampilan & Menu</button>
        <button class="tab-btn" onclick="showTab('data')" id="btn-data">üì• Data Pendaftar</button>
    </div>

    <div id="tab-settings">
        <h3>1. Header & Tampilan Utama</h3>
        <label>Nama Aplikasi:</label> <input id="app_name">
        <label>Link Logo (URL):</label> <input id="logo_url">
        <label>Pengumuman (Running Text):</label> <textarea id="announcement"></textarea>
        <label>Ucapan Selamat Datang:</label> <textarea id="welcome_msg"></textarea>

        <h3>2. Isi Menu</h3>
        <label>Jadwal Kunjungan:</label> <textarea id="txt_jadwal" rows="3"></textarea>
        <label>Syarat & Ketentuan:</label> <textarea id="txt_syarat" rows="3"></textarea>
        <label>Nomor WA Video Call (628xxx):</label> <input id="wa_vc">
        <label>Nomor WA Toko Lapas (628xxx):</label> <input id="wa_toko">
        <label>Kontak & Pengaduan:</label> <textarea id="txt_kontak" rows="3"></textarea>

        <button class="save" onclick="saveData()">üíæ SIMPAN SEMUA PERUBAHAN</button>
    </div>

    <div id="tab-data" style="display:none;">
        <h3>Daftar Pendaftaran Kunjungan</h3>
        <table>
            <thead><tr><th>Tanggal</th><th>Nama</th><th>NIK</th><th>WBP</th><th>Aksi</th></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>

<script>
    // --- KONFIGURASI FIREBASE (PASTE SAMA PERSIS DI SINI) ---
    const firebaseConfig = {
  apiKey: "AIzaSyDvpFZtiG_fXLOf8okjafNm7gqbJZr2pSY",
  authDomain: "lapassistem.firebaseapp.com",
  databaseURL: "https://lapassistem-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "lapassistem",
  storageBucket: "lapassistem.firebasestorage.app",
  messagingSenderId: "951059663532",
  appId: "1:951059663532:web:716bc3010eecc741a4ed09",
  measurementId: "G-25HSNZ35ZH"
};

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Cek Login
    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('panel-box').style.display = 'block';
            loadSettings();
            loadRegistrations();
        } else {
            document.getElementById('login-box').style.display = 'block';
            document.getElementById('panel-box').style.display = 'none';
        }
    });

    function login() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('pass').value;
        auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }
    function logout() { auth.signOut(); }

    function showTab(t) {
        document.getElementById('tab-settings').style.display = (t==='settings') ? 'block' : 'none';
        document.getElementById('tab-data').style.display = (t==='data') ? 'block' : 'none';
        document.getElementById('btn-set').className = (t==='settings') ? 'tab-btn active' : 'tab-btn';
        document.getElementById('btn-data').className = (t==='data') ? 'tab-btn active' : 'tab-btn';
    }

    // LOAD & SAVE SETTINGS
    function loadSettings() {
        db.ref('app_config').once('value', s => {
            if(s.exists()) {
                const d = s.val();
                ['app_name','logo_url','announcement','welcome_msg','txt_jadwal','txt_syarat','wa_vc','wa_toko','txt_kontak'].forEach(k => {
                    document.getElementById(k).value = d[k] || "";
                });
            }
        });
    }

    function saveData() {
        const data = {};
        ['app_name','logo_url','announcement','welcome_msg','txt_jadwal','txt_syarat','wa_vc','wa_toko','txt_kontak'].forEach(k => {
            data[k] = document.getElementById(k).value;
        });
        db.ref('app_config').set(data).then(() => alert("Tersimpan!"));
    }

    // DATA REGISTRATIONS
    function loadRegistrations() {
        db.ref('registrations').on('value', s => {
            const body = document.getElementById('table-body');
            body.innerHTML = "";
            if(s.exists()) {
                Object.entries(s.val()).forEach(([key, val]) => {
                    body.innerHTML += `
                        <tr>
                            <td>${val.tgl}</td>
                            <td>${val.nama}</td>
                            <td>${val.nik}</td>
                            <td>${val.wbp}</td>
                            <td><button onclick="delReg('${key}')" style="background:red; color:white; border:none; cursor:pointer;">Hapus</button></td>
                        </tr>
                    `;
                });
            } else {
                body.innerHTML = "<tr><td colspan='5'>Belum ada data.</td></tr>";
            }
        });
    }

    function delReg(k) {
        if(confirm("Hapus data ini?")) db.ref('registrations/'+k).remove();
    }
</script>
</body>
</html>